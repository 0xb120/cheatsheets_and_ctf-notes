---
author: "PortSwigger Research"
aliases: "Fickle PDFs: Exploiting Browser Rendering Discrepancies"
tags: RW_inbox, readwise/articles
url: https://portswigger.net/research/fickle-pdfs-exploiting-browser-rendering-discrepancies
date: 2024-08-22
---
# Fickle PDFs: Exploiting Browser Rendering Discrepancies

![rw-book-cover](https://portswigger.net/cms/images/38/2c/a55c-twittercard-twitter-card.png)

## Highlights


> Imagine the CEO of a random company receives an email containing a PDF invoice file. In Safari and MacOS Preview, the total price displayed is £399. After approval, the invoice is sent to the accounting department, which operates on Windows OS. However, when the same PDF file is opened in Google Chrome or Google Drive, the price changes to £999.
>  In this article, we will show you how to create a hybrid PDF that abuses widget annotations to create render discrepancies, and share the code so you can generate your own.
>  This research was inspired by Konstantin Weddige's blog post "[Kobold Letters](https://lutrasecurity.com/en/articles/kobold-letters/)".
> [View Highlight](https://read.readwise.io/read/01j5x2xdxgs9pkapcqf43yfcwr)



> A widget annotation represents the appearance of form fields in an interactive PDF form. It will display the text £999 instead. The pseudo code might look like this:
>  `PDDocument document = new PDDocument(); PDAcroForm acroForm = new PDAcroForm(document); PDTextField field = new PDTextField(acroForm); field.setValue("£399"); // Create and set custom appearance stream PDFormXObject appearanceStream = new PDFormXObject(document); ... appearanceContents.showText("£999");`
> [View Highlight](https://read.readwise.io/read/01j5x2y9a5ds290g4hstczs8xb)



> Safari renders the PDF:
>  ![](https://portswigger.net/cms/images/f6/25/fd81-article-safarikoboldpdf.png)
>  Google Chrome and Drive preview render the different total price:
>  ![](https://portswigger.net/cms/images/1c/38/a311-article-chromekoboldpdf.png)
>  Firefox agrees with Google Chrome:
> [View Highlight](https://read.readwise.io/read/01j5x2yg24k44sjcty5tmqezfb)

